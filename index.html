<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>MMORPG æ‰‹æ©Ÿæœ€ä½³åŒ–åœ–å½¢ç‰ˆ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:linear-gradient(135deg,#0a0a0a,#1a1a2e);color:#fff;font-family:'Arial Black',Arial,sans-serif;overflow:hidden;touch-action:none;}
canvas{display:block;width:100vw;height:100vh;background:radial-gradient(circle at center,#2a2a4a 0%,#111 70%);}
#ui{position:fixed;top:5px;left:5px;right:5px;background:rgba(0,0,0,0.7);padding:10px;border-radius:12px;font-size:14px;text-align:center;backdrop-filter: blur(10px);z-index:100;}
#bottomUI{position:fixed;bottom:10px;right:10px;display:flex;gap:10px;z-index:100;}
.skill-btn{width:60px;height:60px;border-radius:50%;background:linear-gradient(45deg,#4A90E2,#357ABD);border:2px solid #fff;font-size:24px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 15px rgba(74,144,226,0.5);position:relative;}
.skill-btn.cd{opacity:0.5;pointer-events:none;}
.cd-bar{position:absolute;bottom:-5px;left:50%;transform:translateX(-50%);width:80%;height:4px;background: rgba(255,255,255,0.8);border-radius:2px;}
.cd-fill{height:100%;background:linear-gradient(90deg,#ff0000,#ffff00);transition:width 0.1s;}
#shopBtn,#invBtn{position: fixed;top:10px;width:50px;height:50px;border-radius:50%;font-size:24px;border:none;cursor:pointer;z-index:100;display:flex;align-items:center;justify-content:center;}
#shopBtn{right:70px;background:#FFD700;color:#000;box-shadow:0 0 15px #FFD700;}
#invBtn{right:10px;background:#4CAF50;color:#fff;box-shadow:0 0 15px #4CAF50;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.9);z-index:200;align-items:center;justify-content:center;}
.modalContent{background:#222;padding:25px;border-radius:15px;text-align:center;max-width:350px;}
.item-btn,.class-btn,.equip-btn{margin:8px 0;padding:12px 20px;border:none;border-radius:10px;cursor:pointer;font-size:16px;}
.item-btn{background:#4CAF50;color:#fff;}
.class-btn{background:linear-gradient(45deg,#4A90E2,#357ABD);color:#fff;}
.equip-btn{background:#FFD700;color:#000;width:100%;}
#joystick{position: fixed;bottom:10px;left:10px;width:100px;height:100px;border-radius:50%;background: rgba(255,255,255,0.2);z-index:100;touch-action:none;}
#stick{position:absolute;left:50%;top:50%;width:50px;height:50px;margin-left:-25px;margin-top:-25px;border-radius:50%;background: rgba(255,255,255,0.5);}
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<div id="ui">
<div>è·æ¥­: <span id="playerClass">æœªé¸æ“‡</span> | ç­‰ç´š: <span id="playerLevel">1</span> | EXP: <span id="exp">0</span>/<span id="nextExp">100</span></div>
<div>HP: <span id="playerHp">100</span>/<span id="playerMaxHp">100</span> | é‡‘å¹£: <span id="gold">0</span></div>
<div>æ€ªç‰©: <span id="monsterCount">0</span></div>
</div>

<div id="bottomUI">
<div class="skill-btn" id="skill1">âš”ï¸<div class="cd-bar"><div class="cd-fill" id="cd1"></div></div></div>
<div class="skill-btn" id="skill2">ğŸŒ€<div class="cd-bar"><div class="cd-fill" id="cd2"></div></div></div>
<div class="skill-btn" id="skill3">ğŸ¹<div class="cd-bar"><div class="cd-fill" id="cd3"></div></div></div>
</div>

<button id="shopBtn">ğŸ›’</button>
<button id="invBtn">ğŸ’</button>

<div id="shopModal" class="modal">
<div class="modalContent">
<h2>å•†åº—</h2>
<p>é‡‘å¹£: <span id="shopGold">0</span></p>
<button class="item-btn" onclick="buyPotion()">HPè—¥æ°´ x1 (50é‡‘)</button>
<button class="item-btn" onclick="buySpeed()">é€Ÿåº¦+1 (200é‡‘)</button>
<button class="item-btn" onclick="closeShop()">é—œé–‰</button>
</div>
</div>

<div id="inventory" class="modal">
<div class="modalContent">
<h2>èƒŒåŒ…</h2>
<div id="invList"></div>
<button class="item-btn" onclick="closeInv()">é—œé–‰</button>
</div>
</div>

<div id="classSelect" class="modal">
<div class="modalContent">
<h2>é¸æ“‡è·æ¥­</h2>
<p>æ±ºå®šä½ çš„éŠç©é¢¨æ ¼</p>
<button class="class-btn" onclick="selectClass('warrior')">âš”ï¸ æˆ°å£«</button>
<button class="class-btn" onclick="selectClass('mage')">ğŸ”® æ³•å¸«</button>
<button class="class-btn" onclick="selectClass('ranger')">ğŸ¹ éŠä¿ </button>
</div>
</div>

<div id="joystick"><div id="stick"></div></div>

<script>
// Canvas
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

// UI
const elements={
playerClassEl: document.getElementById('playerClass'),
playerLevel: document.getElementById('playerLevel'),
exp: document.getElementById('exp'),
nextExp: document.getElementById('nextExp'),
playerHp: document.getElementById('playerHp'),
playerMaxHp: document.getElementById('playerMaxHp'),
gold: document.getElementById('gold'),
monsterCount: document.getElementById('monsterCount'),
shopGold: document.getElementById('shopGold'),
skill1: document.getElementById('skill1'),
skill2: document.getElementById('skill2'),
skill3: document.getElementById('skill3'),
cd1: document.getElementById('cd1'),
cd2: document.getElementById('cd2'),
cd3: document.getElementById('cd3'),
invList: document.getElementById('invList')
};

// Player
let playerClass=null;
let player={x:0,y:0,hp:100,maxHp:100,level:1,exp:0,nextExp:100,gold:0,speed:5,size:25};
let inventory=[];
let monsters=[];
let keys={},gameStarted=false,gameOver=false;

// Classes
const classConfig={
warrior:{speed:4.8,dmgMod:1.5,aoeRange:50,petActive:false},
mage:{speed:5.5,dmgMod:1.2,aoeRange:90,petActive:false},
ranger:{speed:5.2,dmgMod:1.3,aoeRange:70,petActive:true}
};

// Skills
let skillCooldowns = [0,0,0];
const skillMaxCD = [5,8,10]; // ç§’

function useSkill(idx){
    if(skillCooldowns[idx]<=0){
        skillCooldowns[idx] = skillMaxCD[idx];
        // æŠ€èƒ½æ•ˆæœ
        if(idx===0){ // åŠæ“Š: è¿‘è·å‚·å®³
            monsters.forEach(m=>{
                let dx=m.x-player.x,dy=m.y-player.y;
                if(Math.hypot(dx,dy)<50){
                    m.hp-=20*classConfig[playerClass].dmgMod;
                }
            });
        } else if(idx===1){ // æ³•è¡“: ç¯„åœå‚·å®³
            monsters.forEach(m=>{
                let dx=m.x-player.x,dy=m.y-player.y;
                if(Math.hypot(dx,dy)<90){
                    m.hp-=15*classConfig[playerClass].dmgMod;
                }
            });
        } else if(idx===2){ // é ç¨‹ç®­é›¨
            monsters.forEach(m=>{
                m.hp-=10*classConfig[playerClass].dmgMod;
            });
        }
    }
}

// Class select
function selectClass(cls){
    playerClass=cls;
    const c=classConfig[cls];
    player.speed=c.speed;
    elements.playerClassEl.textContent=cls;
    document.getElementById('classSelect').style.display='none';
    initPlayer();
    gameStarted=true;
}

// Init player
function initPlayer(){player.x=canvas.width/2;player.y=canvas.height/2;}

// Shop/Inventory
function toggleShop(){elements.shopGold.textContent=player.gold;document.getElementById('shopModal').style.display=document.getElementById('shopModal').style.display==='flex'?'none':'flex';}
function buyPotion(){if(player.gold>=50){player.gold-=50;inventory.push({name:'HPè—¥æ°´',heal:100});}}
function buySpeed(){if(player.gold>=200){player.gold-=200;player.speed+=1;}}
function closeShop(){document.getElementById('shopModal').style.display='none';}

function toggleInv(){
elements.invList.innerHTML=inventory.map((item,i)=>`<button class="equip-btn" onclick="useItem(${i})">${item.name}</button>`).join('');
document.getElementById('inventory').style.display='flex';
}
function useItem(i){
    let item=inventory[i];
    if(item.heal){player.hp=Math.min(player.maxHp,player.hp+item.heal);}
    inventory.splice(i,1);
    toggleInv();
}
function closeInv(){document.getElementById('inventory').style.display='none';}

// Joystick
const joystick=document.getElementById('joystick'),stick=document.getElementById('stick');
let joyStart={x:0,y:0},joyMove={x:0,y:0},joyActive=false;
joystick.addEventListener('touchstart',e=>{joyActive=true;let t=e.targetTouches[0];joyStart={x:t.clientX,y:t.clientY};});
joystick.addEventListener('touchmove',e=>{if(!joyActive)return;let t=e.targetTouches[0];joyMove={x:t.clientX-joyStart.x,y:t.clientY-joyStart.y};stick.style.transform=`translate(${joyMove.x}px,${joyMove.y}px)`;});
joystick.addEventListener('touchend',e=>{joyActive=false;joyMove={x:0,y:0};stick.style.transform='translate(0,0)';});

// Skill buttons
elements.skill1.addEventListener('touchstart',()=>useSkill(0));
elements.skill2.addEventListener('touchstart',()=>useSkill(1));
elements.skill3.addEventListener('touchstart',()=>useSkill(2));

// Shop/Inv touch
document.getElementById('shopBtn').addEventListener('touchstart',()=>toggleShop());
document.getElementById('invBtn').addEventListener('touchstart',()=>toggleInv());

// UI Update
function updateUI(){
elements.playerLevel.textContent=player.level;
elements.playerHp.textContent=Math.floor(player.hp);
elements.playerMaxHp.textContent=player.maxHp;
elements.gold.textContent=player.gold;
elements.monsterCount.textContent=monsters.length;
elements.exp.textContent=player.exp;
elements.nextExp.textContent=player.nextExp;
}

// Spawn monsters
function spawnMonster(){
monsters.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,size:25,hp:50});
}

// Draw
function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
// Player
ctx.save();
ctx.translate(player.x,player.y);
ctx.fillStyle=playerClass==='warrior'? '#FF6B35':playerClass==='mage'? '#9B59B6':'#27AE60';
ctx.fillRect(-player.size/2,-player.size,player.size,player.size*1.5);
ctx.fillStyle='#FFD700';
ctx.beginPath();ctx.arc(0,-player.size*1.2,player.size/3,0,Math.PI*2);ctx.fill();
ctx.restore();
// Monsters
monsters.forEach(m=>{
ctx.save();
ctx.translate(m.x,m.y);
ctx.fillStyle='#E74C3C';
ctx.fillRect(-m.size/2,-m.size/2,m.size,m.size);
ctx.restore();
});
}

// Skill cooldown update
function updateSkillCD(delta){
skillCooldowns.forEach((cd,i)=>{
if(cd>0) skillCooldowns[i]-=delta;
elements['cd'+(i+1)].style.width = `${Math.max(0, cd/skillMaxCD[i]*100)}%`;
});
}

// Monster AI
function updateMonsters(){
monsters.forEach((m,i)=>{
// Move towards player
let dx=player.x-m.x, dy=player.y-m.y;
let dist=Math.hypot(dx,dy);
if(dist>0){ m.x += dx/dist * 1; m.y += dy/dist *1; }
// Attack player
if(dist<30){ player.hp -= 0.1; }
// Remove dead monster
if(m.hp<=0){ monsters.splice(i,1); player.gold+=10; player.exp+=20; if(player.exp>=player.nextExp){player.level++; player.exp=0; player.nextExp+=50; player.maxHp+=20; player.hp=player.maxHp;}} 
});
}

// Game loop
let lastTime=performance.now();
function gameLoop(now){
let delta=(now-lastTime)/1000; lastTime=now;
if(!gameOver){
player.x += (joyMove.x/50)*player.speed;
player.y += (joyMove.y/50)*player.speed;
player.x=Math.max(player.size,Math.min(canvas.width-player.size,player.x));
player.y=Math.max(player.size,Math.min(canvas.height-player.size,player.y));
if(monsters.length<5) spawnMonster();
updateMonsters();
updateSkillCD(delta);
draw();
updateUI();
if(player.hp<=0){gameOver=true; alert("ä½ æ­»äº†ï¼");}
requestAnimationFrame(gameLoop);
}
}
document.getElementById('classSelect').style.display='flex';
initPlayer();
gameLoop();
</script>
</body>
</html>
