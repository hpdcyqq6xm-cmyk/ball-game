<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>æ‰‹æ©Ÿç‰ˆ RPG éŠæˆ²</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    background: #222;
    touch-action: none;
}

/* --- Canvas --- */
#gameCanvas {
    display: block;
    background: #333;
    margin: auto;
}

/* --- UI æŒ‰éˆ• --- */
.ui-btn {
    position: absolute;
    padding: 10px 18px;
    background: rgba(0,0,0,0.6);
    color: white;
    border: 2px solid #fff;
    border-radius: 10px;
    font-size: 20px;
    user-select: none;
}

/* æ”¾åœ¨ä¸Šæ–¹ */
#shopBtn { top: 10px; left: 10px; }
#bagBtn { top: 10px; right: 10px; }

/* æŠ€èƒ½æŒ‰éˆ•ï¼ˆæ¡Œæ©Ÿ/æ‰‹æ©Ÿå…±ç”¨ï¼‰ */
.skill-btn {
    position: absolute;
    bottom: 20px;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: 3px solid white;
    background: rgba(200,0,0,0.6);
    user-select: none;
}
#skill1Btn { right: 110px; }
#skill2Btn { right: 20px; }

/* å¤§æ‹›æŒ‰éˆ•ï¼ˆæ‰‹æ©Ÿé™å®šï¼‰ */
#ultimateBtn {
    position: absolute;
    bottom: 120px;
    right: 20px;
    width: 90px;
    height: 90px;
    background: rgba(255,180,0,0.7);
    border-radius: 50%;
    border: 4px solid #fff;
    display: none;
}

/* è—¥æ°´æŒ‰éˆ•ï¼ˆæ‰‹æ©Ÿï¼‰ */
#potionBtn {
    position: absolute;
    bottom: 220px;
    right: 25px;
    width: 65px;
    height: 65px;
    background: rgba(0,180,255,0.7);
    border-radius: 15px;
    border: 3px solid #fff;
    display: none;
}

/* æ–æ¡¿ï¼ˆæ‰‹æ©Ÿï¼‰ */
#joystick {
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: rgba(255,255,255,0.12);
    display: none;
}
#knob {
    position: absolute;
    width: 60px;
    height: 60px;
    top: 40px;
    left: 40px;
    border-radius: 50%;
    background: rgba(255,255,255,0.6);
}
</style>
</head>

<body>

<canvas id="gameCanvas" width="900" height="600"></canvas>

<!-- ä¸Šæ–¹ UI -->
<div id="shopBtn" class="ui-btn">å•†åº—</div>
<div id="bagBtn" class="ui-btn">èƒŒåŒ…</div>

<!-- æŠ€èƒ½æŒ‰éˆ• -->
<div id="skill1Btn" class="skill-btn"></div>
<div id="skill2Btn" class="skill-btn"></div>

<!-- æ‰‹æ©Ÿè¿½åŠ æŒ‰éˆ• -->
<div id="ultimateBtn"></div>
<div id="potionBtn"></div>

<!-- è™›æ“¬æ–æ¡¿ -->
<div id="joystick">
    <div id="knob"></div>
</div>

<script>
/* ========================================
    éŠæˆ²è®Šæ•¸ï¼ˆåŸç‰ˆ + é‡æ§‹ï¼‰
======================================== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let gameState = "playing";

let player = {
    x: 450, y: 300,
    size: 30,
    hp: 100,
    maxHp: 100,
    speed: 220,
    gold: 0
};

let enemies = [];

function spawnEnemy() {
    enemies.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        size: 25,
        hp: 40
    });
}

for(let i=0;i<4;i++) spawnEnemy();

/* ========================================
    æ ¸å¿ƒé€šç”¨å‡½å¼
======================================== */
function update(dt){
    // ç§»å‹•ï¼šæ‰‹æŒ‡å„ªå…ˆ
    if (joy.active) {
        player.x += joy.dx * player.speed * dt;
        player.y += joy.dy * player.speed * dt;
    }

    // ç°¡å–® AI
    enemies.forEach(e=>{
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.hypot(dx,dy);
        if(dist>1){
            e.x += dx/dist * 50 * dt;
            e.y += dy/dist * 50 * dt;
        }
    });
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ç©å®¶
    ctx.fillStyle="cyan";
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
    ctx.fill();

    // æ€ªç‰©
    ctx.fillStyle="red";
    enemies.forEach(e=>{
        ctx.beginPath();
        ctx.arc(e.x,e.y,e.size,0,Math.PI*2);
        ctx.fill();
    });

    // è¡€æ¢
    ctx.fillStyle="white";
    ctx.fillText(`HP: ${player.hp}/${player.maxHp}`,10,20);
    ctx.fillText(`Gold: ${player.gold}`,10,40);
}

/* ========================================
    ä¸»å¾ªç’°
======================================== */
let last = performance.now();
function gameLoop(t){
    const dt = (t-last)/1000;
    last = t;

    if(gameState==="playing"){
        update(dt);
        draw();
        requestAnimationFrame(gameLoop);
    }
}
requestAnimationFrame(gameLoop);

/* ========================================
    æŒ‰éˆ•äº‹ä»¶ï¼ˆæ‰‹æ©Ÿ + æ¡Œæ©Ÿï¼‰
======================================== */
function bind(id, fn){
    const el = document.getElementById(id);
    el.addEventListener("click", fn);
    el.addEventListener("touchstart", e=>{
        e.preventDefault();
        fn();
    });
}

bind("shopBtn", ()=>alert("æ‰“é–‹å•†åº—ï¼ˆå¯æ¥ UIï¼‰"));
bind("bagBtn", ()=>alert("æ‰“é–‹èƒŒåŒ…ï¼ˆå¯æ¥ UIï¼‰"));
bind("skill1Btn", ()=>alert("æŠ€èƒ½ 1ï¼"));
bind("skill2Btn", ()=>alert("æŠ€èƒ½ 2ï¼"));
bind("ultimateBtn", ()=>alert("å¤§æ‹›ï¼ï¼ï¼ğŸ”¥"));
bind("potionBtn", ()=>{
    if(player.hp < player.maxHp){
        player.hp = Math.min(player.hp+30, player.maxHp);
    }
});

/* ========================================
    è™›æ“¬æ–æ¡¿ï¼ˆæ‰‹æ©Ÿï¼‰
======================================== */
const joy = {
    active:false,
    dx:0, dy:0
};

const joystick = document.getElementById("joystick");
const knob = document.getElementById("knob");

function isMobile(){
    return /Android|iPhone|iPad/i.test(navigator.userAgent);
}

if(isMobile()){
    joystick.style.display = "block";
    document.getElementById("ultimateBtn").style.display="block";
    document.getElementById("potionBtn").style.display="block";
}

// è§¸æ§é–‹å§‹
joystick.addEventListener("touchstart", e=>{
    e.preventDefault();
    joy.active = true;
});

// ç§»å‹•
joystick.addEventListener("touchmove", e=>{
    e.preventDefault();
    const rect = joystick.getBoundingClientRect();
    const touch = e.touches[0];

    const cx = touch.clientX - (rect.left+rect.width/2);
    const cy = touch.clientY - (rect.top+rect.height/2);

    const dist = Math.min(Math.hypot(cx,cy), 50);
    const ang = Math.atan2(cy,cx);

    joy.dx = Math.cos(ang)*(dist/50);
    joy.dy = Math.sin(ang)*(dist/50);

    knob.style.transform = `translate(${joy.dx*40}px, ${joy.dy*40}px)`;
});

// æ”¾é–‹
joystick.addEventListener("touchend", e=>{
    joy.active=false;
    joy.dx=joy.dy=0;
    knob.style.transform = "translate(0,0)";
});
</script>

</body>
</html>
